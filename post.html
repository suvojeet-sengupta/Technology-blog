<!DOCTYPE html>
<html lang="hi" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>टेक ज्ञान</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body { font-family: 'Inter', 'Noto Sans Devanagari', sans-serif; }
        .markdown-content h2 { scroll-margin-top: 6rem; }
        #progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: linear-gradient(to right, #3b82f6, #8b5cf6); width: 0%; z-index: 50; transition: width 0.1s; }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <div id="progress-bar"></div>

    <!-- Header (Same as index.html) -->
    <header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg shadow-sm sticky top-0 z-20">
        <!-- ... same header code ... -->
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <article id="post-content" class="max-w-4xl mx-auto bg-white dark:bg-slate-800 p-6 sm:p-8 md:p-12 rounded-2xl shadow-lg">
            <!-- Post content will be injected here -->
        </article>

        <!-- Related Posts Section -->
        <section id="related-posts" class="max-w-4xl mx-auto mt-16 hidden">
            <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-8">आपको यह भी पसंद आएगा</h2>
            <div id="related-posts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Related posts will be injected here -->
            </div>
        </section>
    </main>

    <script>
        // --- Dark Mode Logic (No changes) ---
        // ... same as before ...

        // --- Progress Bar Logic ---
        window.addEventListener('scroll', () => {
            const progressBar = document.getElementById('progress-bar');
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrollPercent = (scrollTop / scrollHeight) * 100;
            progressBar.style.width = scrollPercent + "%";
        });

        // --- Post Loading Logic ---
        async function loadPost() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            const articleContainer = document.getElementById('post-content');

            if (!slug) return;

            try {
                const blogsResponse = await fetch(`blogs.json?v=${new Date().getTime()}`);
                const allBlogs = await blogsResponse.json();
                const post = allBlogs.find(p => p.slug === slug);

                if (!post) throw new Error('Post not found');

                const markdownResponse = await fetch(post.post_path);
                const markdown = await markdownResponse.text();
                
                document.title = `${post.title} - टेक ज्ञान`;

                let html = markdown
                    .replace(/^# (.*$)/gim, '')
                    .replace(/^## (.*$)/gim, '<h2 class="text-3xl font-bold mt-12 mb-6 border-l-4 border-blue-500 pl-4">$1</h2>')
                    .replace(/^### (.*$)/gim, '<h3 class="text-2xl font-bold mt-8 mb-4">$1</h3>')
                    .replace(/\*\*(.*)\*\*/g, '<strong>$1</strong>')
                    .replace(/`([^`]+)`/g, '<code class="bg-slate-200 dark:bg-slate-700 text-sm rounded px-1.5 py-1 font-mono">$1</code>')
                    .replace(/^- (.*$)/gim, '<li class="ml-6 list-disc mb-2">$1</li>')
                    .replace(/\n/g, '<br>').replace(/<br><li/g, '<li').replace(/<\/li><br>/g, '</li>');
                
                articleContainer.innerHTML = `
                    <header class="mb-12">
                        <span class="bg-blue-100 text-blue-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">${post.category}</span>
                        <h1 class="mt-4 text-3xl md:text-5xl font-extrabold text-slate-900 dark:text-white">${post.title}</h1>
                        <div class="mt-6 text-slate-500 dark:text-slate-400 flex items-center space-x-4">
                            <span>${post.date}</span><span>&bull;</span><span>${post.read_time} min read</span>
                        </div>
                    </header>
                    <div class="markdown-content text-lg leading-relaxed text-slate-700 dark:text-slate-300">${html}</div>
                    <!-- ... social share footer ... -->
                `;

                // Load Related Posts
                loadRelatedPosts(allBlogs, post.category, post.slug);

            } catch (error) {
                console.error("Failed to load post:", error);
            }
        }

        function loadRelatedPosts(allBlogs, currentCategory, currentSlug) {
            const relatedPosts = allBlogs.filter(p => p.category === currentCategory && p.slug !== currentSlug).slice(0, 3);
            
            if (relatedPosts.length > 0) {
                const grid = document.getElementById('related-posts-grid');
                grid.innerHTML = '';
                relatedPosts.forEach(post => {
                    const postCard = document.createElement('a');
                    postCard.href = `post.html?slug=${post.slug}`;
                    postCard.className = 'post-card block bg-white dark:bg-slate-800 rounded-2xl shadow-lg hover:shadow-xl dark:hover:shadow-blue-500/20 hover:-translate-y-2 transition-all duration-300 p-6';
                    postCard.innerHTML = `
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2 h-14 overflow-hidden">${post.title}</h3>
                        <p class="text-slate-600 dark:text-slate-300 text-xs">${post.excerpt}</p>
                        <div class="mt-4 text-blue-500 dark:text-blue-400 text-sm font-semibold">पूरा पढ़ें &rarr;</div>
                    `;
                    grid.appendChild(postCard);
                });
                document.getElementById('related-posts').classList.remove('hidden');
            }
        }
        
        window.onload = loadPost;
    </script>
</body>
</html>

