<!DOCTYPE html>
<html lang="hi" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>टेक ज्ञान</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body { font-family: 'Inter', 'Noto Sans Devanagari', sans-serif; }
        .markdown-content h2 { scroll-margin-top: 5rem; }
        .toc a.active { color: #3b82f6; font-weight: 700; }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <!-- Header (Same as index.html) -->
    <header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg shadow-sm sticky top-0 z-20">
        <!-- ... same header code ... -->
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 lg:gap-12">
            <article id="post-content" class="lg:col-span-3 bg-white dark:bg-slate-800 p-6 sm:p-8 md:p-12 rounded-2xl shadow-lg">
                <!-- Post content will be injected here -->
            </article>
            <aside class="hidden lg:block">
                <div id="table-of-contents" class="sticky top-28">
                    <!-- TOC will be injected here -->
                </div>
            </aside>
        </div>
    </main>

    <script>
        // --- Dark Mode Logic (No changes) ---
        // ... same as before ...

        // --- Post Loading and TOC Logic ---
        async function loadPost() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            const articleContainer = document.getElementById('post-content');
            const tocContainer = document.getElementById('table-of-contents');

            if (!slug) return;

            try {
                const blogsResponse = await fetch(`blogs.json?v=${new Date().getTime()}`);
                const blogs = await blogsResponse.json();
                const post = blogs.find(p => p.slug === slug);

                if (!post) throw new Error('Post not found');

                const markdownResponse = await fetch(post.post_path);
                const markdown = await markdownResponse.text();
                
                document.title = `${post.title} - टेक ज्ञान`;

                const tocHeadings = [];
                let html = markdown
                    .replace(/^# (.*$)/gim, '')
                    .replace(/^## (.*$)/gim, (match, p1) => {
                        const id = p1.trim().toLowerCase().replace(/\s+/g, '-');
                        tocHeadings.push({ id, title: p1.trim() });
                        return `<h2 id="${id}">${p1}</h2>`;
                    })
                    // ... other replacements ...

                // Build TOC
                if(tocHeadings.length > 0) {
                    let tocHTML = '<h3 class="text-lg font-bold mb-4">इस लेख में</h3><ul class="toc space-y-2">';
                    tocHeadings.forEach(h => {
                        tocHTML += `<li><a href="#${h.id}" class="text-slate-600 dark:text-slate-400 hover:text-blue-500 transition-colors">${h.title}</a></li>`;
                    });
                    tocHTML += '</ul>';
                    tocContainer.innerHTML = tocHTML;
                }

                articleContainer.innerHTML = `
                    <header class="mb-12">
                        <span class="bg-blue-100 text-blue-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">${post.category}</span>
                        <h1 class="mt-4 text-3xl md:text-5xl font-extrabold text-slate-900 dark:text-white">${post.title}</h1>
                        <div class="mt-6 text-slate-500 dark:text-slate-400 flex items-center space-x-4">
                            <span>${post.date}</span><span>&bull;</span><span>${post.read_time} min read</span>
                        </div>
                    </header>
                    <div class="markdown-content text-lg leading-relaxed">${html}</div>
                    <!-- ... social share footer ... -->
                `;
                
                // TOC active state on scroll
                const observer = new IntersectionObserver(entries => {
                    entries.forEach(entry => {
                        const id = entry.target.getAttribute('id');
                        const tocLink = document.querySelector(`.toc a[href="#${id}"]`);
                        if (entry.isIntersecting) {
                            document.querySelectorAll('.toc a').forEach(a => a.classList.remove('active'));
                            tocLink.classList.add('active');
                        }
                    });
                }, { rootMargin: "-30% 0px -60% 0px" });
                document.querySelectorAll('.markdown-content h2').forEach(h2 => observer.observe(h2));

            } catch (error) {
                console.error("Failed to load post:", error);
            }
        }
        
        window.onload = loadPost;
    </script>
</body>
</html>
